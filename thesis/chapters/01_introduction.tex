\chapter{Introduction}
\label{chap:intro}

Type system is a crucial part of any formal system, such as a programming language or a proof assistant. In a world of functional programming, discovery of the Hindley-Milner (HM) type system played an important role of the field advancement. Although easy to implement, the classical algorithm $\mathcal{W}$~\cite{Milner1978_TypePolymorphism} is able to infer the principal type scheme~\cite{Hindley1969_PrincipalTypeScheme} of a term without any hints from a programmer. Moreover, both its soundness and completeness have been theoretically proved~\cite{Damas1984_TypeAssignment}. Ideas discovered by Hindley, Milner, and Damas are at the core of type systems of today's most powerful functional programming languages like ML, OCaml, and Haskell.

Definitely, numerous implementations of the Hindley-Milner type system can be found in both open-source projects and academic literature. Besides original algorithms $\mathcal{W}$~and~$\mathcal{J}$~\cite{Milner1978_TypePolymorphism} introduced in late 1978, other variations of HM-style inference with different goals have arised in recent decades, such as with deferred constraint solving (Heeren \textit{et al.}, 2002~\cite{Heeren2002_GeneralizingHM}), or with coercive subtyping (Traytel \textit{et al.}, 2011~\cite{Traytel2011_HMCoerciveSubtyping}).

Despite the abundance of existing variations and examples, building a correct, efficient, and maintainable implementation of the Hindley-Milner type system, especially with the prospect of future extension, remains a challenging task. For instance, let-generalization in $\mathcal{W}$ is done by traversing the whole type environment~\cite{DamasMilner1982_TypeSchemes}, which can be inefficient. An alternative rank-based (or level-based) generalization approach, introduced by R\'emy~\cite{Remy1992_SortedEqTheoryTypes}, has been employed in OCaml programming language~\cite{Kiselyov2022_OCamplTypeChecker} to achieve better efficiency, though it remains relatively obscure.

Scopes management and capture-avoiding substitution are another obstacles faced by type checker implementors. Efficient and correct implementation of abstract syntax with binders is painless, that is why Google research team developed "foil"~\cite{Foil} â€” a technique for achieving scope-safe and fast substitutions for scoped AST. Free Foil~\cite{FreeFoil} combines foil with data types a l\'a carte approach~\cite{Swierstra2008_a_la_carte}, to make foil's efficient and scope-safe representation of syntax also generic. Generic representation makes it easy to extend functionality with recursive operations such as traversal, or alpha equivalence check.

We believe that type checking can be a generic and modular component, enabling prototyping of new type systems easier, in a similar way how Free Foil simplifies adding support of binders to a language.

This work makes a small step towards the belief with the following contributions. First, we demonstrate an implementation of a Hindley-Milner-style type inference algorithm in Haskell, which is based on scope-safe abstract syntax generated with Free~Foil~\cite{FreeFoil}. Second, we adopt the idea of level-based type generalization to the inference. Third, we test the correctness of the algorithm on a test suite of more than 50 test cases with both well and ill typed sets of programs. Finally, we propose further steps for creating a generic version of the implemented algorithm, which could be used as a flexible type inference library once created.

Source code of this and related works of my colleagues is avilable at\newline \href{https://github.com/evermake/free-foil-typecheck}{github.com/evermake/free-foil-typecheck}.
